<?xml version="1.0" encoding="UTF-8"?>
<configuration>
	<include
		resource="org/springframework/boot/logging/logback/defaults.xml" />
	<springProperty scope="context" name="springAppName"
		source="spring.application.name" />
	<springProperty scope="context" name="currentEnv"
		source="spring.profiles.active" />

	<property name="LOG_PATH" value="./logs"></property>

	<appender name="CONSOLE"
		class="ch.qos.logback.core.ConsoleAppender">
		<encoder>
			<pattern>%d{HH:mm:ss.SSS} %X{X-B3-TraceId:-} %X{X-B3-SpanId:-}
				[%thread] %-5level %logger : %msg%n</pattern>
		</encoder>
	</appender>

	<appender name="FILE"
		class="ch.qos.logback.core.rolling.RollingFileAppender">
		<encoder>
			<pattern>%d{HH:mm:ss.SSS} %X{X-B3-TraceId:-} %X{X-B3-SpanId:-}
				[%thread] %-5level %logger : %msg%n</pattern>
		</encoder>
		<append>true</append>
		<rollingPolicy
			class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
			<fileNamePattern>${LOG_PATH}/demo-${spring.profiles.active}/%d{yyyy-MM-dd}.%i.log
			</fileNamePattern>
			<MaxHistory>30</MaxHistory>
			<timeBasedFileNamingAndTriggeringPolicy
				class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP">
				<maxFileSize>50MB</maxFileSize>
			</timeBasedFileNamingAndTriggeringPolicy>
		</rollingPolicy>
	</appender>

	<appender name="ASYNC"
		class="ch.qos.logback.classic.AsyncAppender">
		<discardingThreshold>0</discardingThreshold>
		<queueSize>512</queueSize>
		<appender-ref ref="FILE"></appender-ref>
	</appender>

	<springProfile name="local">
		<root level="INFO">
			<appender-ref ref="CONSOLE" />
		</root>
		<logger name="com.eagle.app.demo.*.external" level="DEBUG" />
	</springProfile>

	<springProfile name="dev,sit">
		<root level="INFO">
			<appender-ref ref="CONSOLE" />
			<appender-ref ref="ASYNC" />
		</root>
		<logger name="com.eagle.app.demo.infrastructure.repositoryies"
			level="TRACE" />
		<logger name="com.eagle.app.demo.infrastructure.brokers"
			level="DEBUG" />
		<logger name="org.apache.http" level="INFO" />
		<logger name="org.apache.skywalking" level="INFO" />
	</springProfile>

	<springProfile name="uat">
		<root level="INFO">
			<appender-ref ref="ASYNC" />
		</root>
		<logger name="com.eagle.app.demo.infrastructure.repositoryies"
			level="TRACE" />
		<logger name="com.eagle.app.demo.infrastructure.brokers"
			level="DEBUG" />
		<logger name="com.csii.pe.transport.transform" level="DEBUG" />
		<logger name="org.apache.skywalking" level="INFO" />
	</springProfile>

	<springProfile name="prod">
		<root level="INFO">
			<appender-ref ref="ASYNC" />
		</root>
		<logger name="com.eagle.app.demo.infrastructure.repositoryies"
			level="TRACE" />
		<logger name="com.eagle.app.demo.infrastructure.brokers"
			level="DEBUG" />
		<logger name="com.csii.pe.transport.transform" level="DEBUG" />
		<logger name="org.apache.skywalking" level="INFO" />
	</springProfile>
</configuration>